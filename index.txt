<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freshwater Vault - Client Portal</title>
    
    <!-- REACT & TAILWIND SETUP -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; background: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- ICONS (Self-Contained to prevent React errors) ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Icons = {
            Shield: (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></IconBase>,
            MessageSquare: (props) => <IconBase {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" /></IconBase>,
            FileCheck: (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><path d="m9 15 2 2 4-4" /></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6" /></IconBase>,
            ArrowRight: (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></IconBase>,
            Zap: (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></IconBase>,
            Lock: (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></IconBase>,
            X: (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconBase>,
            FileText: (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></IconBase>,
            CheckCircle: (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconBase>,
            Edit3: (props) => <IconBase {...props}><path d="M12 20h9" /><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" /></IconBase>,
            Send: (props) => <IconBase {...props}><line x1="22" y1="2" x2="11" y2="13" /><polygon points="22 2 15 22 11 13 2 9 22 2" /></IconBase>,
            RefreshCw: (props) => <IconBase {...props}><polyline points="23 4 23 10 17 10" /><polyline points="1 20 1 14 7 14" /><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" /></IconBase>,
            Mail: (props) => <IconBase {...props}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" /><polyline points="22,6 12,13 2,6" /></IconBase>,
            MapPin: (props) => <IconBase {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" /></IconBase>
        };

        const { 
            Shield, MessageSquare, FileCheck, ChevronRight, ArrowRight, 
            Zap, Lock, X, FileText, CheckCircle, Edit3, Send, 
            RefreshCw, Mail, MapPin 
        } = Icons;

        // --- CONFIGURATION ---
        const CONFIG = {
            GEMINI_API_KEY: "", // Add key if needed
            YOUR_EMAIL: "freshwaterlandscaping@gmail.com"
        };

        // --- LEGAL TEXT ---
        const AGREEMENT_TEXT = `FRESHWATER LANDSCAPING LLC MASTER SERVICE AGREEMENT

ARTICLE I: DEFINITIONS
"Agreement" means this Master Service Agreement, together with all Addenda.
"Client" means the property owner or agent identified in the Quote.
"Contractor" means Freshwater Landscaping LLC.

ARTICLE IV: PAYMENT TERMS
4.6 Late Payments. Any undisputed payment not received within fifteen (15) days of its due date will accrue a finance charge of one and one-half percent (1.5%) per month (18% APR).

ARTICLE VII: CANCELLATION & TERMINATION
16.1 Client Cancellation. Client may cancel this Agreement as follows:
- Within 48 hours of acceptance: Full refund of deposit.
- After 48 hours but >7 days before start: Forfeiture of 15% of deposit.

ARTICLE XII: LIMITATION OF LIABILITY
12.1 Liability Cap. The total cumulative liability of Freshwater Landscaping LLC shall not exceed the lesser of: (A) the total contract price actually paid by Client; or (B) the available proceeds from Contractor's applicable insurance.

RESIDENTIAL SNOW & ICE MANAGEMENT ADDENDUM
S-1.2 Trigger. Plowing begins at 0.5 inches of accumulation.
S-1.3 Response Time. Standard response is 12-24 hours after snow stops.`;

        const App = () => {
            const [view, setView] = useState('landing');
            const [chatInput, setChatInput] = useState("");
            const [chatHistory, setChatHistory] = useState([
                { role: 'ai', text: "Hello! I'm your Freshwater Legal Assistant. I've analyzed your signed Master Service Agreement. Ask me anything about your contract terms." }
            ]);
            const [isTyping, setIsTyping] = useState(false);
            const [accessCode, setAccessCode] = useState("");
            const [clientData, setClientData] = useState(null);
            const [isLoadingClient, setIsLoadingClient] = useState(false);
            
            // Signature State
            const [showSignature, setShowSignature] = useState(false);
            const [showDocViewer, setShowDocViewer] = useState(false);
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [hasSignature, setHasSignature] = useState(false);

            const clientDocs = [
                { id: 1, title: 'Master Service Agreement', signed: 'Jan 15, 2026', type: 'Core Contract', status: 'active' },
                { id: 2, title: 'Residential Snow Addendum', signed: 'Jan 15, 2026', type: 'Service Specific', status: 'active' },
                { id: 3, title: 'Mowing & Maintenance Addendum', signed: 'Feb 01, 2026', type: 'Service Specific', status: 'active' }
            ];

            // --- ACTIONS ---

            const handleAccessVault = async () => {
                if (accessCode.length < 4) return;
                setIsLoadingClient(true);
                // Simulate API Call
                setTimeout(() => {
                    setClientData({
                        name: "Valued Client",
                        email: "client@example.com",
                        address: "Freshwater Service Property",
                        city: "Chanhassen, MN",
                        jobberClientId: accessCode
                    });
                    setIsLoadingClient(false);
                    setView('dashboard');
                }, 1500);
            };

            const handleChat = async () => {
                if (!chatInput.trim()) return;
                const userMsg = chatInput;
                setChatHistory(prev => [...prev, { role: 'user', text: userMsg }]);
                setChatInput("");
                setIsTyping(true);

                // Simulate AI response logic
                setTimeout(() => {
                    const responses = [
                        "Based on Section S-1.2 of your Residential Snow Addendum, plowing services trigger automatically at 0.5 inches of accumulation.",
                        "Your agreement caps liability at the total contract price paid. This is defined in Article XII, Section 12.1.",
                        "Standard response time is 12-24 hours after the snow stops falling, per Section S-1.3.",
                        "Late payments accrue interest at 1.5% per month (18% APR) after 15 days, according to Article IV."
                    ];
                    const reply = responses[Math.floor(Math.random() * responses.length)];
                    setChatHistory(prev => [...prev, { role: 'ai', text: reply }]);
                    setIsTyping(false);
                }, 1000);
            };

            // --- SIGNATURE LOGIC ---
            const startDrawing = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const y = (e.clientY || e.touches?.[0]?.clientY) - rect.top;
                const ctx = canvas.getContext('2d');
                ctx.beginPath();
                ctx.moveTo(x, y);
                setIsDrawing(true);
                setHasSignature(true);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                e.preventDefault();
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const y = (e.clientY || e.touches?.[0]?.clientY) - rect.top;
                const ctx = canvas.getContext('2d');
                ctx.lineTo(x, y);
                ctx.strokeStyle = '#1e293b';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.stroke();
            };

            const stopDrawing = () => setIsDrawing(false);
            const clearSignature = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                setHasSignature(false);
            };

            useEffect(() => {
                if (canvasRef.current && showSignature) {
                    const canvas = canvasRef.current;
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                }
            }, [showSignature]);

            // --- RENDER ---

            if (view === 'landing') {
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6 text-white font-sans">
                        <div className="max-w-md w-full space-y-8 text-center">
                            <div className="flex justify-center">
                                <div className="bg-blue-600 p-6 rounded-3xl shadow-2xl shadow-blue-500/20 ring-4 ring-blue-500/20">
                                    <Shield size={56} />
                                </div>
                            </div>
                            <div className="space-y-2">
                                <h1 className="text-4xl font-black tracking-tight">Freshwater <span className="text-blue-400">Vault</span></h1>
                                <p className="text-slate-400 text-lg">Secure Document Portal</p>
                            </div>
                            <div className="bg-slate-800/50 backdrop-blur-sm p-8 rounded-2xl border border-slate-700/50 shadow-xl space-y-6">
                                <div className="text-left space-y-2">
                                    <label className="text-xs font-bold text-slate-400 uppercase tracking-wider">Client Access Code</label>
                                    <input 
                                        type="text" 
                                        value={accessCode}
                                        onChange={(e) => setAccessCode(e.target.value)}
                                        placeholder="Enter code" 
                                        className="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 transition text-center text-lg font-mono text-white"
                                    />
                                </div>
                                <button 
                                    onClick={handleAccessVault}
                                    disabled={accessCode.length < 4 || isLoadingClient}
                                    className="w-full bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 py-4 rounded-xl font-bold transition flex items-center justify-center gap-2"
                                >
                                    {isLoadingClient ? "Verifying..." : "Access Vault"} <ArrowRight size={20} />
                                </button>
                            </div>
                            <p className="text-[10px] text-slate-600 uppercase tracking-widest">Encrypted • Secure • AI Powered</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900">
                    <nav className="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm">
                        <div className="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setView('landing')}>
                                <div className="bg-blue-600 p-2 rounded-lg"><Shield className="text-white" size={20} /></div>
                                <span className="font-black text-xl tracking-tight">FRESHWATER <span className="text-blue-600">VAULT</span></span>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setView('dashboard')} className={`px-4 py-2 rounded-lg font-semibold text-sm transition ${view === 'dashboard' ? 'bg-blue-50 text-blue-600' : 'text-slate-600 hover:bg-slate-100'}`}>Documents</button>
                                <button onClick={() => setView('chat')} className={`px-4 py-2 rounded-lg font-semibold text-sm transition flex items-center gap-2 ${view === 'chat' ? 'bg-blue-50 text-blue-600' : 'text-slate-600 hover:bg-slate-100'}`}><MessageSquare size={16} /> Ask AI</button>
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-6xl mx-auto p-6">
                        {view === 'dashboard' ? (
                            <div className="space-y-8">
                                <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-2xl p-6 shadow-lg">
                                    <h2 className="text-2xl font-bold mb-1">Welcome back, {clientData?.name}!</h2>
                                    <div className="flex flex-col gap-2 text-blue-100 text-sm mt-3">
                                        <div className="flex items-center gap-2"><MapPin size={14} /> <span>{clientData?.address}</span></div>
                                        <div className="flex items-center gap-2"><CheckCircle size={14} /> <span>Account Status: Active</span></div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {clientDocs.map(doc => (
                                        <div key={doc.id} onClick={() => setShowDocViewer(true)} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md hover:border-blue-300 transition cursor-pointer group">
                                            <div className="flex items-start justify-between mb-4">
                                                <div className="bg-blue-50 p-3 rounded-xl text-blue-600"><FileCheck size={24} /></div>
                                                <span className="text-xs px-2 py-1 bg-green-50 text-green-700 rounded-full font-medium">Active</span>
                                            </div>
                                            <h3 className="font-bold text-lg mb-1">{doc.title}</h3>
                                            <p className="text-xs text-slate-500 mb-3">{doc.type}</p>
                                            <div className="flex items-center justify-between text-xs text-slate-400">
                                                <span>Signed: {doc.signed}</span>
                                                <ChevronRight className="text-slate-300 group-hover:text-blue-500" size={16} />
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="bg-white rounded-3xl p-8 border border-slate-200 relative overflow-hidden shadow-sm">
                                    <div className="relative z-10 max-w-xl">
                                        <div className="flex items-center gap-2 mb-3 text-blue-600">
                                            <Zap size={24} />
                                            <span className="text-xs font-bold uppercase tracking-wider">AI-Powered Assistant</span>
                                        </div>
                                        <h3 className="text-2xl font-bold mb-3">Questions about your coverage?</h3>
                                        <p className="text-slate-500 mb-6 leading-relaxed">
                                            Our intelligent assistant has analyzed your signed agreements and can instantly explain terms, triggers, and liability caps.
                                        </p>
                                        <button onClick={() => setView('chat')} className="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-slate-800 transition flex items-center gap-2">
                                            Start Legal Chat <ArrowRight size={18} />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="bg-white rounded-2xl shadow-lg border border-slate-200 h-[70vh] flex flex-col overflow-hidden">
                                <div className="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-blue-100 p-2 rounded-lg text-blue-600"><Zap size={20} /></div>
                                        <div>
                                            <h3 className="font-bold text-sm">Contract Assistant</h3>
                                            <p className="text-xs text-slate-500">Trained on your specific MSA & Addenda</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6 space-y-4">
                                    {chatHistory.map((msg, i) => (
                                        <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`max-w-[80%] p-4 rounded-2xl text-sm ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-slate-100 text-slate-800 rounded-tl-none'}`}>
                                                {msg.text}
                                            </div>
                                        </div>
                                    ))}
                                    {isTyping && <div className="text-xs text-slate-400 ml-4 animate-pulse">Analyzing contract...</div>}
                                </div>
                                <div className="p-4 border-t border-slate-100 flex gap-2">
                                    <input 
                                        type="text" 
                                        value={chatInput} 
                                        onChange={(e) => setChatInput(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleChat()}
                                        placeholder="Ask about cancellation or snow triggers..."
                                        className="flex-1 bg-slate-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <button onClick={handleChat} className="bg-blue-600 text-white p-3 rounded-xl hover:bg-blue-700"><Send size={20} /></button>
                                </div>
                            </div>
                        )}
                    </main>

                    {showDocViewer && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
                                <div className="flex justify-between p-6 border-b border-slate-200">
                                    <div className="flex items-center gap-3"><FileText className="text-blue-600" size={24} /><h2 className="font-bold">Master Service Agreement</h2></div>
                                    <button onClick={() => setShowDocViewer(false)}><X size={24} /></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6 bg-slate-50">
                                    <div className="bg-white p-8 shadow-sm border border-slate-200 whitespace-pre-wrap text-sm">{AGREEMENT_TEXT}</div>
                                </div>
                                <div className="p-4 border-t border-slate-200 flex justify-between">
                                    <button onClick={() => setShowSignature(true)} className="px-6 py-2 bg-green-600 text-white rounded-lg flex gap-2 items-center"><Edit3 size={18} /> Sign Agreement</button>
                                    <button onClick={() => setShowDocViewer(false)} className="px-6 py-2 bg-blue-600 text-white rounded-lg">Close</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showSignature && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full flex flex-col">
                                <div className="p-6 border-b border-slate-200 flex justify-between">
                                    <h2 className="font-bold">Sign Agreement</h2>
                                    <button onClick={() => setShowSignature(false)}><X size={24} /></button>
                                </div>
                                <div className="p-6">
                                    <div className="border-2 border-dashed border-slate-300 rounded-xl bg-slate-50 touch-none">
                                        <canvas 
                                            ref={canvasRef}
                                            onMouseDown={startDrawing} onMouseMove={draw} onMouseUp={stopDrawing} onMouseLeave={stopDrawing}
                                            onTouchStart={startDrawing} onTouchMove={draw} onTouchEnd={stopDrawing}
                                            className="w-full h-48 cursor-crosshair rounded-xl"
                                        />
                                    </div>
                                    <button onClick={clearSignature} className="mt-2 text-sm text-slate-500 flex items-center gap-1"><RefreshCw size={14} /> Clear</button>
                                </div>
                                <div className="p-6 border-t border-slate-200 flex justify-end gap-3">
                                    <button onClick={() => setShowSignature(false)} className="px-6 py-2 text-slate-600 hover:bg-slate-100 rounded-lg">Cancel</button>
                                    <button 
                                        onClick={() => { alert('Signed & Sent!'); setShowSignature(false); setShowDocViewer(false); }}
                                        disabled={!hasSignature}
                                        className="px-6 py-2 bg-blue-600 text-white rounded-lg disabled:bg-slate-300"
                                    >
                                        Sign & Send
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>